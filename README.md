# curly-memory
# üå± Gerenciador de Produtores Rurais

Bem-vindo ao **Gerenciador de Produtores Rurais**, um sistema desenvolvido em **Node.js com AdonisJS** para cadastro e gerenciamento de produtores, fazendas e culturas plantadas.

## üöÄ Tecnologias Utilizadas
- **AdonisJS**
- **PostgreSQL**
- **Docker**
- **Japa (Testes)**
- **Swagger (Documenta√ß√£o)**
- **Lucid (ORM)**

---

## üìå **Instala√ß√£o e Configura√ß√£o**

### üîπ **Pr√©-requisitos**
Antes de iniciar, certifique-se de ter instalado:
- **Node.js 18+**
- **Docker e Docker Compose**
- **PostgreSQL**
- **PNPM (ou npm/yarn, caso prefira)**

### üîπ **Passo a Passo**
1. **Clone o reposit√≥rio**
2. **Instale as depend√™ncias**
3. **Configure o ambiente**: Copie o arquivo .env.example e renomeie para .env, ajustando as vari√°veis de acordo com seu ambiente.
4. **Execute as migrations**: 
```sh
node ace migration:run
```
5. **Execute as seeders (IMPORTANTE: rodar na ordem correta)**:
```sh 
node ace db:seed --files "database/seeders/producer_seeder.ts"
```
```sh 
node ace db:seed --files "database/seeders/property_seeder.ts" 
```
```sh
node ace db:seed --files "database/seeders/planting_seeder.ts"
```
7. **Inicie a aplica√ß√£o**: 
```sh 
npm run dev 
```

---

## üìñ **Relacionamento entre Tabelas**
O banco de dados possui tr√™s entidades principais: **Produtores (Producers)**, **Fazendas (Properties)** e **Plantios (Plantings)**.

### üîπ **Diagrama de Relacionamento**
| Producers |-- 1:N -- | Properties |-- 1:N -- | Plantings |


### üîπ **Explica√ß√£o**
#### **1. Producers (Produtores)**
- Cada produtor **pode ter v√°rias fazendas** (1:N).
- **Campos**: 
  - id *(UUID, PK)*
  - name *(string)*
  - documentType *(CPF ou CNPJ)*
  - document *(string do documento)*
  - city *(string)*
  - state *(string)*

#### **2. Properties (Fazendas)**
- Cada fazenda **pertence a um √∫nico produtor** (`producer_id`).
- Cada fazenda **pode ter v√°rios plantios** (1:N).
- **Campos**: 
  - id *(UUID, PK)*
  - producer_id *(UUID, FK -> Producers)*
  - farm_name *(string)*
  - city *(string)*
  - state *(string)*
  - total_area *(float)*
  - arable_area *(float)*
  - vegetation_area *(float)*

#### **3. Plantings (Plantios)**
- Cada plantio **pertence a uma √∫nica fazenda** (`property_id`).
- **Campos**: 
  - id *(UUID, PK)*
  - property_id *(UUID, FK -> Producers)*
  - harvest *(string)*: Safra
  - culture *(string)*: Cultura

---

### üîπ **Restri√ß√µes e Regras**
- **Integridade Referencial**:  
  - Se um **produtor for exclu√≠do**, todas as **fazendas** relacionadas tamb√©m s√£o exclu√≠das (**cascade delete**).
  - Se uma **fazenda for exclu√≠da**, todos os **plantios** relacionados tamb√©m s√£o removidos (**cascade delete**).

- **Regras de √Årea**:
  - A **√°rea agricult√°vel + √°rea de vegeta√ß√£o** **n√£o pode ser maior que a √°rea total** da fazenda.

- **Valida√ß√£o de Documentos**:
  - O **CPF/CNPJ** do produtor √© validado antes do cadastro.

---

### üìö **Rotas da API**

Abaixo est√£o as principais rotas do sistema.

üîπ Produtores (/producers)
M√©todo	Rota	Descri√ß√£o	Exemplo Body
GET	/producers	Lista todos os produtores	-
GET	/producers/:id	Busca um produtor pelo ID	-
POST	/producers	Cria um novo produtor	{ "name": "Jo√£o", "document": "12345678900", "city": "SP", "state": "SP" }
PUT	/producers/:id	Atualiza um produtor	{ "name": "Maria" }
DELETE	/producers/:id	Remove um produtor	-

üîπ Fazendas (/properties)
M√©todo	Rota	Descri√ß√£o	Exemplo Body
GET	/producers/:id/properties	Lista fazendas de um produtor	-
GET	/properties/:id	Busca uma fazenda pelo ID	-
POST	/producers/:id/properties	Cria uma nova fazenda	{ "farm_name": "Fazenda 1", "city": "SP", "state": "SP", "total_area": 100, "arable_area": 60, "vegetation_area": 40 }
PUT	/properties/:id	Atualiza uma fazenda	{ "farm_name": "Fazenda Nova" }
DELETE	/properties/:id	Remove uma fazenda	-

üîπ Plantios (/plantings)
M√©todo	Rota	Descri√ß√£o	Exemplo Body
GET	/properties/:id/plantings	Lista os plantios de uma fazenda	-
GET	/plantings/:id	Busca um plantio pelo ID	-
POST	/properties/:id/plantings	Cria um novo plantio	{ "culture": "Soja", "harvest": "2024" }
PUT	/plantings/:id	Atualiza um plantio	{ "culture": "Milho" }
DELETE	/plantings/:id	Remove um plantio	-

üìä Dashboard & Estat√≠sticas

M√©todo	Rota	Descri√ß√£o
GET	/dashboard/total-stats	Retorna total de fazendas e hectares cadastrados
GET	/dashboard/land-use-stats	Retorna percentual de √°rea agricult√°vel e vegeta√ß√£o
GET	/dashboard/by-state	Retorna n√∫mero de fazendas por estado
GET	/dashboard/by-crop	Retorna n√∫mero de fazendas por cultura plantada

üõ† Rodando Testes

Antes de rodar os testes, execute as seeders na seguinte ordem:

node ace db:seed --files "database/seeders/ProducerSeeder.ts"
node ace db:seed --files "database/seeders/PropertySeeder.ts"
node ace db:seed --files "database/seeders/PlantingSeeder.ts"
Agora, execute os testes de unidade e integra√ß√£o:

node ace test
